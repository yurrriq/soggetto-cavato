<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Arrows, ScopedTypeVariables, NamedFieldPuns, FlexibleContexts #-}</span><span></span><span>
</span><a name="line-2"></a><span></span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Render a Music object to a audio signal function that can be further</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- manipulated or saved to a file.  It is channel-agnostic in that it is</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- able to deal with instruments of arbitrary number of channels.</span><span>
</span><a name="line-6"></a><span></span><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Euterpea</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Audio</span><span class="hs-operator">.</span><span class="hs-identifier">Render</span><span> </span><span class="hs-special">(</span><span></span><span>
</span><a name="line-8"></a><span>  </span><a href="Euterpea.IO.Audio.Render.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Render.html#InstrMap"><span class="hs-identifier hs-type">InstrMap</span></a><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Render.html#renderSF"><span class="hs-identifier hs-var">renderSF</span></a><span class="hs-special">,</span><span> </span><span>
</span><a name="line-9"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span></span><span>
</span><a name="line-10"></a><span></span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span></span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span class="hs-operator">.</span><span class="hs-identifier">Operations</span><span></span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Arrow.ArrowP.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span class="hs-operator">.</span><span class="hs-identifier">ArrowP</span></a><span></span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Control.SF.SF.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">SF</span><span class="hs-operator">.</span><span class="hs-identifier">SF</span></a><span></span><span>
</span><a name="line-15"></a><span></span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="Euterpea.Music.html"><span class="hs-identifier">Euterpea</span><span class="hs-operator">.</span><span class="hs-identifier">Music</span></a><span></span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="Euterpea.IO.MIDI.MEvent.html"><span class="hs-identifier">Euterpea</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">MIDI</span><span class="hs-operator">.</span><span class="hs-identifier">MEvent</span></a><span></span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Euterpea.IO.Audio.Basics.html"><span class="hs-identifier">Euterpea</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Audio</span><span class="hs-operator">.</span><span class="hs-identifier">Basics</span></a><span></span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Euterpea.IO.Audio.Types.html"><span class="hs-identifier">Euterpea</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Audio</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span></span><span>
</span><a name="line-20"></a><span></span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span></span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span></span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Ord</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-24"></a><span></span><span>
</span><a name="line-25"></a><span class="hs-comment">-- Every instrument is a function that takes a duration, absolute</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- pitch, volume, and a list of parameters (Doubles).  What the function </span><span>
</span><a name="line-27"></a><span class="hs-comment">-- actually returns is implementation independent.</span><span>
</span><a name="line-28"></a><span class="hs-keyword">type</span><span> </span><a name="Instr"><a href="Euterpea.IO.Audio.Render.html#Instr"><span class="hs-identifier">Instr</span></a></a><span> </span><a name="local-6989586621679088076"><a href="#local-6989586621679088076"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Euterpea.Music.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.Music.html#AbsPitch"><span class="hs-identifier hs-type">AbsPitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.Music.html#Volume"><span class="hs-identifier hs-type">Volume</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679088076"><span class="hs-identifier hs-type">a</span></a><span></span><span>
</span><a name="line-29"></a><span></span><span>
</span><a name="line-30"></a><span class="hs-keyword">type</span><span> </span><a name="InstrMap"><a href="Euterpea.IO.Audio.Render.html#InstrMap"><span class="hs-identifier">InstrMap</span></a></a><span> </span><a name="local-6989586621679088075"><a href="#local-6989586621679088075"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Euterpea.Music.html#InstrumentName"><span class="hs-identifier hs-type">InstrumentName</span></a><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Render.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span> </span><a href="#local-6989586621679088075"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-31"></a><span></span><span>
</span><a name="line-32"></a><span class="hs-identifier">lookupInstr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Euterpea.Music.html#InstrumentName"><span class="hs-identifier hs-type">InstrumentName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.IO.Audio.Render.html#InstrMap"><span class="hs-identifier hs-type">InstrMap</span></a><span> </span><a href="#local-6989586621679088592"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.IO.Audio.Render.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span> </span><a href="#local-6989586621679088592"><span class="hs-identifier hs-type">a</span></a><span></span><span>
</span><a name="line-33"></a><a name="lookupInstr"><a href="Euterpea.IO.Audio.Render.html#lookupInstr"><span class="hs-identifier">lookupInstr</span></a></a><span> </span><a name="local-6989586621679088593"><a href="#local-6989586621679088593"><span class="hs-identifier">ins</span></a></a><span> </span><a name="local-6989586621679088594"><a href="#local-6989586621679088594"><span class="hs-identifier">im</span></a></a><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-34"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621679088593"><span class="hs-identifier hs-var">ins</span></a><span> </span><a href="#local-6989586621679088594"><span class="hs-identifier hs-var">im</span></a><span> </span><span class="hs-keyword">of</span><span></span><span>
</span><a name="line-35"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679088595"><a href="#local-6989586621679088595"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679088595"><span class="hs-identifier hs-var">i</span></a><span></span><span>
</span><a name="line-36"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Instrument &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679088593"><span class="hs-identifier hs-var">ins</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span>
</span><a name="line-37"></a><span>                 </span><span class="hs-string">&quot; does not have a matching Instr in the supplied InstrMap.&quot;</span><span></span><span>
</span><a name="line-38"></a><span></span><span>
</span><a name="line-39"></a><span class="hs-comment">-- Each note in a Performance is tagged with a unique NoteId, which</span><span>
</span><a name="line-40"></a><span class="hs-comment">-- helps us keep track of the signal function associated with a note.</span><span>
</span><a name="line-41"></a><span class="hs-keyword">type</span><span> </span><a name="NoteId"><a href="Euterpea.IO.Audio.Render.html#NoteId"><span class="hs-identifier">NoteId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span></span><span>
</span><a name="line-42"></a><span></span><span>
</span><a name="line-43"></a><span class="hs-comment">-- In this particular implementation, 'a' is the signal function that</span><span>
</span><a name="line-44"></a><span class="hs-comment">-- plays the given note.</span><span>
</span><a name="line-45"></a><span class="hs-keyword">data</span><span> </span><a name="NoteEvt"><a href="Euterpea.IO.Audio.Render.html#NoteEvt"><span class="hs-identifier">NoteEvt</span></a></a><span> </span><a name="local-6989586621679088074"><a href="#local-6989586621679088074"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NoteOn"><a href="Euterpea.IO.Audio.Render.html#NoteOn"><span class="hs-identifier">NoteOn</span></a></a><span>  </span><a href="Euterpea.IO.Audio.Render.html#NoteId"><span class="hs-identifier hs-type">NoteId</span></a><span> </span><a href="#local-6989586621679088074"><span class="hs-identifier hs-type">a</span></a><span></span><span>
</span><a name="line-46"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a name="NoteOff"><a href="Euterpea.IO.Audio.Render.html#NoteOff"><span class="hs-identifier">NoteOff</span></a></a><span> </span><a href="Euterpea.IO.Audio.Render.html#NoteId"><span class="hs-identifier hs-type">NoteId</span></a><span></span><span>
</span><a name="line-47"></a><span></span><span>
</span><a name="line-48"></a><span class="hs-keyword">type</span><span> </span><a name="Evt"><a href="Euterpea.IO.Audio.Render.html#Evt"><span class="hs-identifier">Evt</span></a></a><span> </span><a name="local-6989586621679088073"><a href="#local-6989586621679088073"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Render.html#NoteEvt"><span class="hs-identifier hs-type">NoteEvt</span></a><span> </span><a href="#local-6989586621679088073"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Timestamp in seconds, and the note event</span><span>
</span><a name="line-49"></a><span></span><span>
</span><a name="line-50"></a><span></span><span>
</span><a name="line-51"></a><span class="hs-comment">-- Turn an Event into a NoteOn and a matching NoteOff with the same NodeId.  </span><span>
</span><a name="line-52"></a><span class="hs-identifier">eventToEvtPair</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Euterpea.IO.Audio.Render.html#InstrMap"><span class="hs-identifier hs-type">InstrMap</span></a><span> </span><a href="#local-6989586621679088591"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.IO.MIDI.MEvent.html#MEvent"><span class="hs-identifier hs-type">MEvent</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Euterpea.IO.Audio.Render.html#Evt"><span class="hs-identifier hs-type">Evt</span></a><span> </span><a href="#local-6989586621679088591"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-53"></a><a name="eventToEvtPair"><a href="Euterpea.IO.Audio.Render.html#eventToEvtPair"><span class="hs-identifier">eventToEvtPair</span></a></a><span> </span><a name="local-6989586621679088596"><a href="#local-6989586621679088596"><span class="hs-identifier">imap</span></a></a><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.MIDI.MEvent.html#MEvent"><span class="hs-identifier hs-var">MEvent</span></a><span> </span><span class="hs-special">{</span><a name="local-6989586621679088597"><a href="#local-6989586621679088597"><span class="hs-identifier">eTime</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679088598"><a href="#local-6989586621679088598"><span class="hs-identifier">eInst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679088599"><a href="#local-6989586621679088599"><span class="hs-identifier">ePitch</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679088600"><a href="#local-6989586621679088600"><span class="hs-identifier">eDur</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679088601"><a href="#local-6989586621679088601"><span class="hs-identifier">eVol</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679088602"><a href="#local-6989586621679088602"><span class="hs-identifier">eParams</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679088603"><a href="#local-6989586621679088603"><span class="hs-identifier">nid</span></a></a><span> </span><span class="hs-glyph">=</span><span></span><span>
</span><a name="line-54"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679088604"><a href="#local-6989586621679088604"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Euterpea.IO.Audio.Render.html#lookupInstr"><span class="hs-identifier hs-var">lookupInstr</span></a><span> </span><a href="#local-6989586621679088598"><span class="hs-identifier hs-var">eInst</span></a><span> </span><a href="#local-6989586621679088596"><span class="hs-identifier hs-var">imap</span></a><span></span><span>
</span><a name="line-55"></a><span>        </span><a name="local-6989586621679088605"><a href="#local-6989586621679088605"><span class="hs-identifier">tOn</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621679088597"><span class="hs-identifier hs-var">eTime</span></a><span></span><span>
</span><a name="line-56"></a><span>        </span><a name="local-6989586621679088606"><a href="#local-6989586621679088606"><span class="hs-identifier">tDur</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621679088600"><span class="hs-identifier hs-var">eDur</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span></span><span>
</span><a name="line-57"></a><span>        </span><a name="local-6989586621679088607"><a href="#local-6989586621679088607"><span class="hs-identifier">sf</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679088604"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621679088600"><span class="hs-identifier hs-var">eDur</span></a><span> </span><a href="#local-6989586621679088599"><span class="hs-identifier hs-var">ePitch</span></a><span> </span><a href="#local-6989586621679088601"><span class="hs-identifier hs-var">eVol</span></a><span> </span><a href="#local-6989586621679088602"><span class="hs-identifier hs-var">eParams</span></a><span></span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679088605"><span class="hs-identifier hs-var">tOn</span></a><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Render.html#NoteOn"><span class="hs-identifier hs-var">NoteOn</span></a><span> </span><a href="#local-6989586621679088603"><span class="hs-identifier hs-var">nid</span></a><span> </span><a href="#local-6989586621679088607"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088605"><span class="hs-identifier hs-var">tOn</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679088606"><span class="hs-identifier hs-var">tDur</span></a><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Render.html#NoteOff"><span class="hs-identifier hs-var">NoteOff</span></a><span> </span><a href="#local-6989586621679088603"><span class="hs-identifier hs-var">nid</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-59"></a><span></span><span>
</span><a name="line-60"></a><span class="hs-comment">-- Turn a Performance into an SF of NoteOn/NoteOffs.  </span><span>
</span><a name="line-61"></a><span class="hs-comment">-- For each note, generate a unique id to tag the NoteOn and NoteOffs.</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- The tag is used as the key to the collection of signal functions</span><span>
</span><a name="line-63"></a><span class="hs-comment">-- for efficient insertion/removal.</span><span>
</span><a name="line-64"></a><span class="hs-identifier">toEvtSF</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Euterpea.IO.Audio.Types.html#Clock"><span class="hs-identifier hs-type">Clock</span></a><span> </span><a href="#local-6989586621679088589"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Euterpea.IO.MIDI.MEvent.html#MEvent"><span class="hs-identifier hs-type">MEvent</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.IO.Audio.Render.html#InstrMap"><span class="hs-identifier hs-type">InstrMap</span></a><span> </span><a href="#local-6989586621679088590"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088589"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Euterpea.IO.Audio.Render.html#Evt"><span class="hs-identifier hs-type">Evt</span></a><span> </span><a href="#local-6989586621679088590"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span></span><span>
</span><a name="line-65"></a><a name="toEvtSF"><a href="Euterpea.IO.Audio.Render.html#toEvtSF"><span class="hs-identifier">toEvtSF</span></a></a><span> </span><a name="local-6989586621679088608"><a href="#local-6989586621679088608"><span class="hs-identifier">pf</span></a></a><span> </span><a name="local-6989586621679088609"><a href="#local-6989586621679088609"><span class="hs-identifier">imap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679088610"><a href="#local-6989586621679088610"><span class="hs-identifier">evts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span>
</span><a name="line-67"></a><span>                 </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Render.html#eventToEvtPair"><span class="hs-identifier hs-var">eventToEvtPair</span></a><span> </span><a href="#local-6989586621679088609"><span class="hs-identifier hs-var">imap</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088608"><span class="hs-identifier hs-var">pf</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span></span><span>
</span><a name="line-68"></a><span>          </span><span class="hs-comment">-- Sort all NoteOn/NoteOff events by timestamp.</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">proc</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span></span><span>
</span><a name="line-70"></a><span>         </span><span class="hs-identifier">rec</span><span></span><span>
</span><a name="line-71"></a><span>           </span><a name="local-6989586621679088611"><a href="#local-6989586621679088611"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Euterpea.IO.Audio.Basics.html#integral"><span class="hs-identifier hs-var">integral</span></a><span> </span><span class="hs-operator">-&lt;</span><span> </span><span class="hs-number">1</span><span></span><span>
</span><a name="line-72"></a><span>           </span><a name="local-6989586621679088612"><a href="#local-6989586621679088612"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">delay</span><span> </span><a href="#local-6989586621679088610"><span class="hs-identifier hs-var">evts</span></a><span> </span><span class="hs-operator">-&lt;</span><span> </span><a href="#local-6989586621679088614"><span class="hs-identifier hs-var">next</span></a><span></span><span>
</span><a name="line-73"></a><span>           </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679088613"><a href="#local-6989586621679088613"><span class="hs-identifier">evs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679088614"><a href="#local-6989586621679088614"><span class="hs-identifier">next</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">span</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679088611"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088612"><span class="hs-identifier hs-var">es</span></a><span></span><span>
</span><a name="line-74"></a><span>             </span><span class="hs-comment">-- Trim events that are due off the list and output them,</span><span>
</span><a name="line-75"></a><span>             </span><span class="hs-comment">-- retaining the rest</span><span>
</span><a name="line-76"></a><span>         </span><a href="Euterpea.IO.Audio.Basics.html#outA"><span class="hs-identifier hs-var">outA</span></a><span> </span><span class="hs-operator">-&lt;</span><span> </span><a href="#local-6989586621679088613"><span class="hs-identifier hs-var">evs</span></a><span></span><span>
</span><a name="line-77"></a><span></span><span>
</span><a name="line-78"></a><span class="hs-comment">-- Modify the collection upon receiving NoteEvts.  The timestamps </span><span>
</span><a name="line-79"></a><span class="hs-comment">-- are not used here, but they are expected to be the same.</span><span>
</span><a name="line-80"></a><span></span><span>
</span><a name="line-81"></a><span class="hs-identifier">modSF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">M</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-6989586621679088083"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Euterpea.IO.Audio.Render.html#Evt"><span class="hs-identifier hs-type">Evt</span></a><span> </span><a href="#local-6989586621679088083"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">M</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-6989586621679088083"><span class="hs-identifier hs-type">a</span></a><span></span><span>
</span><a name="line-82"></a><a name="modSF"><a href="Euterpea.IO.Audio.Render.html#modSF"><span class="hs-identifier">modSF</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621679088615"><span class="hs-identifier hs-var">mod</span></a><span></span><span>
</span><a name="line-83"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679088615"><a href="#local-6989586621679088615"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621679088616"><a href="#local-6989586621679088616"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Render.html#NoteOn"><span class="hs-identifier hs-var">NoteOn</span></a><span> </span><a name="local-6989586621679088617"><a href="#local-6989586621679088617"><span class="hs-identifier">nid</span></a></a><span> </span><a name="local-6989586621679088618"><a href="#local-6989586621679088618"><span class="hs-identifier">sf</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span> </span><a href="#local-6989586621679088617"><span class="hs-identifier hs-var">nid</span></a><span> </span><a href="#local-6989586621679088618"><span class="hs-identifier hs-var">sf</span></a><span> </span><a href="#local-6989586621679088616"><span class="hs-identifier hs-var">m</span></a><span></span><span>
</span><a name="line-84"></a><span>          </span><span class="hs-identifier">mod</span><span> </span><a name="local-6989586621679088619"><a href="#local-6989586621679088619"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Render.html#NoteOff"><span class="hs-identifier hs-var">NoteOff</span></a><span> </span><a name="local-6989586621679088620"><a href="#local-6989586621679088620"><span class="hs-identifier">nid</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">delete</span><span> </span><a href="#local-6989586621679088620"><span class="hs-identifier hs-var">nid</span></a><span> </span><a href="#local-6989586621679088619"><span class="hs-identifier hs-var">m</span></a><span></span><span>
</span><a name="line-85"></a><span></span><span>
</span><a name="line-86"></a><span></span><span>
</span><a name="line-87"></a><span class="hs-comment">-- Simplified version of a parallel switcher.  </span><span>
</span><a name="line-88"></a><span class="hs-comment">-- Note that this is tied to the particular implementation of SF, as it</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- needs to use runSF to run all the signal functions in the collection.</span><span>
</span><a name="line-90"></a><span></span><span>
</span><a name="line-91"></a><span class="hs-identifier">pSwitch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679088080"><a href="#local-6989586621679088080"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679088081"><a href="#local-6989586621679088081"><span class="hs-identifier">col</span></a></a><span> </span><a name="local-6989586621679088082"><a href="#local-6989586621679088082"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Types.html#Clock"><span class="hs-identifier hs-type">Clock</span></a><span> </span><a href="#local-6989586621679088080"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679088081"><span class="hs-identifier hs-type">col</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span></span><span>
</span><a name="line-92"></a><span>           </span><a href="#local-6989586621679088081"><span class="hs-identifier hs-type">col</span></a><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088080"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Initial SF collection.</span><span>
</span><a name="line-93"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088080"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Euterpea.IO.Audio.Render.html#Evt"><span class="hs-identifier hs-type">Evt</span></a><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088080"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Input event stream.</span><span>
</span><a name="line-94"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088081"><span class="hs-identifier hs-type">col</span></a><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088080"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Euterpea.IO.Audio.Render.html#Evt"><span class="hs-identifier hs-type">Evt</span></a><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088080"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679088081"><span class="hs-identifier hs-type">col</span></a><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088080"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-95"></a><span>           </span><span class="hs-comment">-- A Modifying function that modifies the collection of SF</span><span>
</span><a name="line-96"></a><span>           </span><span class="hs-comment">--   based on the event that is occuring.</span><span>
</span><a name="line-97"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088080"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088081"><span class="hs-identifier hs-type">col</span></a><span> </span><a href="#local-6989586621679088082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>  </span><span>
</span><a name="line-98"></a><span>           </span><span class="hs-comment">-- The resulting collection of output values obtained from</span><span>
</span><a name="line-99"></a><span>           </span><span class="hs-comment">--   running all SFs in the collection.</span><span>
</span><a name="line-100"></a><span></span><span>
</span><a name="line-101"></a><a name="pSwitch"><a href="Euterpea.IO.Audio.Render.html#pSwitch"><span class="hs-identifier">pSwitch</span></a></a><span> </span><a name="local-6989586621679088621"><a href="#local-6989586621679088621"><span class="hs-identifier">col</span></a></a><span> </span><a name="local-6989586621679088622"><a href="#local-6989586621679088622"><span class="hs-identifier">esig</span></a></a><span> </span><a name="local-6989586621679088623"><a href="#local-6989586621679088623"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-identifier">proc</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span></span><span>
</span><a name="line-103"></a><span>      </span><a name="local-6989586621679088624"><a href="#local-6989586621679088624"><span class="hs-identifier">evts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679088622"><span class="hs-identifier hs-var">esig</span></a><span> </span><span class="hs-operator">-&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span></span><span>
</span><a name="line-104"></a><span>      </span><span class="hs-identifier">rec</span><span></span><span>
</span><a name="line-105"></a><span>        </span><span class="hs-comment">-- perhaps this can be run at a lower rate using upsample</span><span>
</span><a name="line-106"></a><span>        </span><a name="local-6989586621679088625"><a href="#local-6989586621679088625"><span class="hs-identifier">sfcol</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">delay</span><span> </span><a href="#local-6989586621679088621"><span class="hs-identifier hs-var">col</span></a><span> </span><span class="hs-operator">-&lt;</span><span> </span><a href="#local-6989586621679088623"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621679088628"><span class="hs-identifier hs-var">sfcol'</span></a><span> </span><a href="#local-6989586621679088624"><span class="hs-identifier hs-var">evts</span></a><span>  </span><span>
</span><a name="line-107"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679088626"><a href="#local-6989586621679088626"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679088629"><a href="#local-6989586621679088629"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">runSF</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">strip</span><span> </span><a href="#local-6989586621679088629"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088625"><span class="hs-identifier hs-var">sfcol</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679088081"><span class="hs-identifier hs-type">col</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679088082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.SF.SF.html#SF"><span class="hs-identifier hs-type">SF</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-108"></a><span>            </span><span class="hs-special">(</span><span class="hs-keyword">as</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679088628"><a href="#local-6989586621679088628"><span class="hs-identifier">sfcol'</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679088081"><span class="hs-identifier hs-type">col</span></a><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088080"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679088626"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Control.Arrow.ArrowP.html#ArrowP"><span class="hs-identifier hs-var">ArrowP</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088626"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-109"></a><span>      </span><a href="Euterpea.IO.Audio.Basics.html#outA"><span class="hs-identifier hs-var">outA</span></a><span> </span><span class="hs-operator">-&lt;</span><span> </span><span class="hs-keyword">as</span><span></span><span>
</span><a name="line-110"></a><span></span><span>
</span><a name="line-111"></a><span></span><span>
</span><a name="line-112"></a><span class="hs-identifier">renderSF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Types.html#Clock"><span class="hs-identifier hs-type">Clock</span></a><span> </span><a href="#local-6989586621679088077"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><span> </span><a href="Euterpea.Music.html#ToMusic1"><span class="hs-identifier hs-type">ToMusic1</span></a><span> </span><a href="#local-6989586621679088078"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Types.html#AudioSample"><span class="hs-identifier hs-type">AudioSample</span></a><span> </span><a href="#local-6989586621679088079"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span>
</span><a name="line-113"></a><span>            </span><a href="Euterpea.Music.html#Music"><span class="hs-identifier hs-type">Music</span></a><span> </span><a href="#local-6989586621679088078"><span class="hs-identifier hs-type">a</span></a><span> </span><span>
</span><a name="line-114"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Euterpea.IO.Audio.Render.html#InstrMap"><span class="hs-identifier hs-type">InstrMap</span></a><span> </span><span class="hs-special">(</span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088077"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088079"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-115"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Double</span><span class="hs-special">,</span><span> </span><a href="Euterpea.IO.Audio.Types.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679088077"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679088079"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-116"></a><span>            </span><span class="hs-comment">-- ^ Duration of the music in seconds, </span><span>
</span><a name="line-117"></a><span>            </span><span class="hs-comment">-- and a signal function that plays the music.</span><span>
</span><a name="line-118"></a><span></span><span>
</span><a name="line-119"></a><a name="renderSF"><a href="Euterpea.IO.Audio.Render.html#renderSF"><span class="hs-identifier">renderSF</span></a></a><span> </span><a name="local-6989586621679088630"><a href="#local-6989586621679088630"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679088631"><a href="#local-6989586621679088631"><span class="hs-identifier">im</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-120"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679088632"><a href="#local-6989586621679088632"><span class="hs-identifier">pf</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679088633"><a href="#local-6989586621679088633"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Euterpea.IO.MIDI.MEvent.html#perform1Dur"><span class="hs-identifier hs-var">perform1Dur</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Euterpea.Music.html#toMusic1"><span class="hs-identifier hs-var">toMusic1</span></a><span> </span><a href="#local-6989586621679088630"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-comment">-- Updated 16-Dec-2015 </span><span>
</span><a name="line-121"></a><span>        </span><a name="local-6989586621679088634"><a href="#local-6989586621679088634"><span class="hs-identifier">evtsf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Euterpea.IO.Audio.Render.html#toEvtSF"><span class="hs-identifier hs-var">toEvtSF</span></a><span> </span><a href="#local-6989586621679088632"><span class="hs-identifier hs-var">pf</span></a><span> </span><a href="#local-6989586621679088631"><span class="hs-identifier hs-var">im</span></a><span></span><span>
</span><a name="line-122"></a><span>        </span><a name="local-6989586621679088635"><a href="#local-6989586621679088635"><span class="hs-identifier">allsf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Euterpea.IO.Audio.Render.html#pSwitch"><span class="hs-identifier hs-var">pSwitch</span></a><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><a href="#local-6989586621679088634"><span class="hs-identifier hs-var">evtsf</span></a><span> </span><a href="Euterpea.IO.Audio.Render.html#modSF"><span class="hs-identifier hs-var">modSF</span></a><span></span><span>
</span><a name="line-123"></a><span>        </span><a name="local-6989586621679088636"><a href="#local-6989586621679088636"><span class="hs-identifier">sf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679088635"><span class="hs-identifier hs-var">allsf</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">arr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="Euterpea.IO.Audio.Types.html#mix"><span class="hs-identifier hs-var">mix</span></a><span> </span><a href="Euterpea.IO.Audio.Types.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- add up all samples</span><span>
</span><a name="line-124"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621679088633"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679088636"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span></span><span>
</span><a name="line-125"></a></pre></body></html>